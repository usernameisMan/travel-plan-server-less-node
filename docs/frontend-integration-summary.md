# å‰ç«¯æ•°æ®ç»“æ„é›†æˆæ€»ç»“

## ğŸ¯ å®Œæˆçš„å·¥ä½œ

æˆ‘å·²ç»ä¸ºä½ çš„å‰ç«¯æ•°æ®ç»“æ„åˆ›å»ºäº†å®Œæ•´çš„åç«¯æ”¯æŒï¼ŒåŒ…æ‹¬ï¼š

### 1. DTO æ•°æ®éªŒè¯ (`lib/dto/itinerary.dto.ts`)
- âœ… `LocationDto` - ä½ç½®æ•°æ®éªŒè¯
- âœ… `TrackDto` - åœ°ç‚¹æ ‡è®°éªŒè¯
- âœ… `ItineraryDayDto` - è¡Œç¨‹å¤©æ•°éªŒè¯
- âœ… `CreatePacketWithItineraryDto` - å®Œæ•´åˆ›å»ºè¯·æ±‚éªŒè¯
- âœ… å“åº” DTO - æ ‡å‡†åŒ–å“åº”æ ¼å¼

### 2. API ç«¯ç‚¹ (`api/packets.ts`)
- âœ… `POST /api/packets/with-itinerary` - åˆ›å»ºå¸¦è¡Œç¨‹çš„ packet
- âœ… `GET /api/packets/:id/with-itinerary` - è·å–å®Œæ•´è¡Œç¨‹æ•°æ®
- âœ… æ•°æ®åº“äº‹åŠ¡å¤„ç†
- âœ… é”™è¯¯å¤„ç†å’Œå›æ»š

## ğŸ“Š æ•°æ®æµç¨‹å›¾

```
å‰ç«¯æ•°æ® â†’ API éªŒè¯ â†’ æ•°æ®åº“å­˜å‚¨
    â†“           â†“           â†“
[
  {                      Packet è¡¨
    day: "Day 1",   â†’    ItineraryDay è¡¨  
    dayText: "ç¬¬1å¤©",      â†“
    tracks: [        â†’   Marker è¡¨
      {
        type: "star",
        location: {lng, lat},
        title: "åœ°ç‚¹",
        description: "æè¿°"
      }
    ]
  }
]
```

## ğŸ”— æ•°æ®åº“è¡¨å…³ç³»

```sql
Packet (1) â”€â”€â”€ (N) ItineraryDay (1) â”€â”€â”€ (N) Marker
  â†“                    â†“                      â†“
- id (PK)           - id (PK, UUID)       - id (PK, UUID)  
- name              - name (dayText)      - title
- userId            - packetId (FK)       - lon (location.lng)
- description       - dayNumber (day)     - lat (location.lat)
- cost              - description         - type
- currencyCode                            - description
                                          - packetId (FK)
                                          - dayId (FK)
                                          - userId
                                          - sortOrder
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```javascript
// ä½ çš„åŸå§‹æ•°æ®ç»“æ„
const yourFrontendData = [
  {
    "day": "Day 1",
    "dayText": "ç¬¬1å¤©",
    "description": "",
    "tracks": [
      {
        "type": "star",
        "location": {
          "lng": "104.00038193898553",
          "lat": "30.613771626296227"
        },
        "title": "1",
        "description": "2"
      }
      // ... æ›´å¤šåœ°ç‚¹
    ]
  }
  // ... æ›´å¤šå¤©æ•°
];

// ç›´æ¥è°ƒç”¨ API
const response = await fetch('/api/packets/with-itinerary', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    name: "æˆ‘çš„æ—…è¡Œè®¡åˆ’",
    description: "ç²¾å½©æ—…ç¨‹",
    cost: "1500.00",
    currencyCode: "CNY",
    itinerary: yourFrontendData  // ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€è½¬æ¢ï¼
  })
});

const result = await response.json();
console.log('ä¿å­˜æˆåŠŸ:', result);
```

## âœ… æ ¸å¿ƒç‰¹æ€§

### 1. é›¶è½¬æ¢é›†æˆ
- ç›´æ¥ä½¿ç”¨ä½ çš„å‰ç«¯æ•°æ®ç»“æ„
- æ— éœ€ä»»ä½•æ•°æ®è½¬æ¢æˆ–æ ¼å¼è°ƒæ•´
- ä¿æŒåŸæœ‰çš„å­—æ®µåå’Œç»“æ„

### 2. å®Œæ•´æ•°æ®éªŒè¯
- æ¯ä¸ªå­—æ®µéƒ½æœ‰éªŒè¯è§„åˆ™
- åµŒå¥—å¯¹è±¡éªŒè¯æ”¯æŒ
- æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯

### 3. äº‹åŠ¡å®‰å…¨
- æ•°æ®åº“äº‹åŠ¡ç¡®ä¿ä¸€è‡´æ€§
- å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
- è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥

### 4. å…³ç³»å®Œæ•´æ€§
- æ­£ç¡®å»ºç«‹è¡¨é—´å…³ç³»
- ä¿æŒæ•°æ®å¼•ç”¨å®Œæ•´æ€§
- æ”¯æŒçº§è”æŸ¥è¯¢

## ğŸ“‹ API ç«¯ç‚¹æ€»ç»“

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|------|
| `/api/packets/with-itinerary` | POST | åˆ›å»ºå¸¦è¡Œç¨‹çš„packet | æ¥å—ä½ çš„å‰ç«¯æ•°æ®ç»“æ„ |
| `/api/packets/:id/with-itinerary` | GET | è·å–å®Œæ•´è¡Œç¨‹æ•°æ® | è¿”å›ç»“æ„åŒ–çš„å®Œæ•´æ•°æ® |
| `/api/packets` | GET | è·å–ç”¨æˆ·æ‰€æœ‰packets | ç®€å•åˆ—è¡¨ï¼Œä¸å«è¡Œç¨‹è¯¦æƒ… |
| `/api/packets/:id` | GET | è·å–å•ä¸ªpacket | åŸºæœ¬ä¿¡æ¯ï¼Œä¸å«è¡Œç¨‹è¯¦æƒ… |

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- âœ… **ç”¨æˆ·è®¤è¯**: æ‰€æœ‰æ“ä½œéœ€è¦ JWT token
- âœ… **ç”¨æˆ·éš”ç¦»**: åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- âœ… **è¾“å…¥éªŒè¯**: å®Œæ•´çš„ DTO éªŒè¯
- âœ… **SQL æ³¨å…¥é˜²æŠ¤**: TypeORM å‚æ•°åŒ–æŸ¥è¯¢
- âœ… **äº‹åŠ¡å®‰å…¨**: æ•°æ®ä¸€è‡´æ€§ä¿éšœ

## ğŸ“– ä½¿ç”¨æ–‡æ¡£

è¯¦ç»†æ–‡æ¡£è¯·å‚è€ƒï¼š
- [è¡Œç¨‹æ•°æ® API æ–‡æ¡£](./itinerary-api.md) - å®Œæ•´çš„ API ä½¿ç”¨è¯´æ˜
- [Packets API æ–‡æ¡£](./packets-api.md) - åŸºç¡€ packet æ“ä½œ
- [ç”¨æˆ·è®¤è¯æ–‡æ¡£](./user-authentication.md) - è®¤è¯ç›¸å…³

## ğŸ‰ æ€»ç»“

ç°åœ¨ä½ å¯ä»¥ï¼š

1. **ç›´æ¥ä½¿ç”¨ä½ çš„å‰ç«¯æ•°æ®** - æ— éœ€ä»»ä½•æ ¼å¼è½¬æ¢
2. **ä¸€æ¬¡æ€§ä¿å­˜æ‰€æœ‰æ•°æ®** - packetã€è¡Œç¨‹å¤©æ•°ã€åœ°ç‚¹æ ‡è®°å…¨éƒ¨ä¿å­˜
3. **è·å–å®Œæ•´çš„ç»“æ„åŒ–æ•°æ®** - åŒ…å«æ‰€æœ‰å…³è”ä¿¡æ¯çš„å“åº”
4. **äº«å—ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript æ”¯æŒ
5. **æ•°æ®å®‰å…¨å¯é ** - äº‹åŠ¡å¤„ç†ç¡®ä¿æ•°æ®å®Œæ•´æ€§

ä½ çš„å‰ç«¯æ•°æ®ç»“æ„ç°åœ¨å®Œç¾é›†æˆåˆ°äº†åç«¯ç³»ç»Ÿä¸­ï¼ğŸš€ 